<!DOCTYPE html>
<html>
<head>
  <style>
  .fields {
    font-size: 25px;
    color: whitesmoke;
    font-family: Arial, Helvetica, sans-serif;
  }
  .stats {
    display: none;
    font-size: 25px;
    color: whitesmoke;
    font-family: Arial, Helvetica, sans-serif

  }
  .middle {
    position: absolute;
    left: 30%;
    padding-left: 25px;
    padding-right: 25px;
    transform: translateX(-30%);
    background-color: rgba(50, 50, 50, 0.9)
  }
  .bg {
    background-image: url("background.jpeg");
    height: 100%;
    /* Center and scale the image nicely */
    background-position: top;
    background-repeat: no-repeat;
    background-size: cover;
    background-attachment: fixed
  }
  </style>


  <script>
    function init() {
      document.getElementById("txt_played").value = getCookieValue("played")
      document.getElementById("txt_wins").value = getCookieValue("wins")
      document.getElementById("rng_target_win_rate").value = (getCookieValue("targetWinRate") * 100)
      if (getCookieValue("returningUser") == "true") {
          caclulateStats()
      }
      else {
          alert("We use cookies to store your games played, games won and target win rate for your convenience. By using this service you agree to cookies.")
      }
    }

    function getCookieValue(a) {
        var b = document.cookie.match('(^|;)\\s*' + a + '\\s*=\\s*([^;]+)');
        return b ? b.pop() : '';
    }

    function setDisplayMode(className, displayState){
      var elements = document.getElementsByClassName(className)

      for (var i = 0; i < elements.length; i++){
          elements[i].style.display = displayState;
        }
    }

    function getWinsToReachTarget(gamesPlayed, gamesWon, targetWinRate) {
      var hypPlayed = gamesPlayed
      var hypWon = gamesWon
      while((hypWon / hypPlayed) < targetWinRate) {
        hypWon++
        hypPlayed++
      }
      return (hypPlayed - gamesPlayed)
    }

    function caclulateStats() {
      var gamesPlayed = document.getElementById("txt_played").value
      var gamesWon = document.getElementById("txt_wins").value
      var targetWinRate = document.getElementById("rng_target_win_rate").value / 100
      document.cookie = "played=" + gamesPlayed + "; expires=Fri, 31 Dec 9999 23:59:59 GMT";
      document.cookie = "wins=" + gamesWon + "; expires=Fri, 31 Dec 9999 23:59:59 GMT";
      document.cookie = "targetWinRate=" + targetWinRate + "; expires=Fri, 31 Dec 9999 23:59:59 GMT";
      document.cookie = "returningUser=" + true + "; expires=Fri, 31 Dec 9999 23:59:59 GMT";

      document.getElementById("lbl_games_played").innerHTML = "Games played: " + gamesPlayed
      document.getElementById("lbl_games_won").innerHTML = "Games won: " + gamesWon
      document.getElementById("lbl_games_lost").innerHTML = "Games lost: " + (gamesPlayed - gamesWon)
      document.getElementById("lbl_win_rate").innerHTML = "Win rate: " + ((gamesWon / gamesPlayed) * 100).toFixed(3) + "%"
      document.getElementById("lbl_rounded_win_rate").innerHTML = "Population One rounded win rate: " + ((gamesWon / gamesPlayed).toFixed(2) * 100) + "%"
      document.getElementById("lbl_wins_at_stake").innerHTML = "Wins at stake: " + (getWinsToReachTarget(+gamesPlayed + 1, gamesWon, targetWinRate) - getWinsToReachTarget(gamesPlayed, gamesWon, targetWinRate))
      document.getElementById("lbl_games_to_target").innerHTML = "Consecutive games to reach goal: " + (getWinsToReachTarget(gamesPlayed, gamesWon, targetWinRate))
      setDisplayMode("stats", "block")
    }

    function updateTargetWinRateRange() {
      document.getElementById("lbl_rng_target_win_rate").innerHTML = document.getElementById("rng_target_win_rate").value
      caclulateStats()
    }

    function addWin(){
      document.getElementById("txt_played").value++
      document.getElementById("txt_wins").value++
      caclulateStats()
    }

    function addLoss(){
      document.getElementById("txt_played").value++
      caclulateStats()
    }
  </script>

  <title>Population One Win Rate Calculator</title>
</head>


<body onload="init();" class="bg">

  <div class="middle">
    <img src="title.png" alt="title" style="display:block; margin-left: auto; margin-right: auto;">
    <div class="fields" style=".fields">
      <h3>Input your games played, and wins, we'll then give you some stats.</h3>
      <p>Games played:
      <input id="txt_played" type="number" name="txt_played" placeholder="games played">
      <br/>
      <p>Games won:
      <input id="txt_wins" type="number" name="txt_wins" placeholder="games won">
      <br/>
      <p>Target win rate:
      <input type="range" id="rng_target_win_rate" style="font-size: 50px; max-height: 15px" name="rng_target_win_rate" min="0" max="99" value="69" step="1" oninput="updateTargetWinRateRange()">
      <label id="lbl_rng_target_win_rate" for="rng_target_win_rate">69</label>
      <br/>
      <button type="button" name="btn_calculate" formtarget="_self" onclick="caclulateStats()">Calculate</button>
    </div>
    <br/>
    <div class="stats" style=".stats">
      <h3>Stats:</h3>
      <p id="lbl_games_played"> Games played: </p>
      <p id="lbl_games_won"> Games won: </p>
      <p id="lbl_games_lost"> Games lost: </p>
      <p id="lbl_win_rate" contextmenu="The actual percentage of games won out of the ones you've played"> Accurate win rate: </p>
      <p id="lbl_rounded_win_rate" contextmenu="Win percentage they way it is displayed in the Stat menu in Pop one"> Population One rounded win rate: </p>
      <p id="lbl_wins_at_stake" contextmenu="How many wins you loose in term of progress towards your goal for loosing a match"> Wins at stake: </p>
      <h3 id="lbl_games_to_target" contextmenu="How many games you need to win in a row to reach the goal"> Consecutive games to reach goal: </h3>

      <input type="image" src="addwin.jpeg" height="auto" width="46%" name="btn_addWin" onclick="addWin()"> </input>
      <input type="image" src="addloss.jpeg" height="auto" width="49%" name="btn_addLoss" onclick="addLoss()"> </input>
    </div>
  </div>
</body>
</html>
